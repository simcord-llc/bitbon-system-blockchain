version: '3.4'
services:
  client:
    build: ../
    hostname: client
    restart: always
    ports:
      - "10300:30303"
      - "10300:30303/udp"
      - "10500:8545"
    entrypoint: ["./entrypoint.sh"]
    volumes:
      - ./files/archive-nodes.json:/root/.ethereum/bitbon/geth/archive-nodes.json:rw
      - ./files/trusted-nodes.json:/root/.ethereum/bitbon/trusted-nodes.json:rw
      - ./files/static-nodes.json:/root/.ethereum/bitbon/static-nodes.json:rw
      - ./files/genesis.json:/root/files/genesis.json:ro
      - ./entrypoint_client.sh:/entrypoint.sh
      - /etc/localtime:/etc/localtime:ro
    networks:
      nodes:
        ipv4_address: 172.30.238.112
    logging:
      driver: gelf
      options:
        gelf-address: "udp://192.168.253.21:11202"
        tag: "cpos-good-dev"
  agent:
    build: ../
    hostname: agent
    restart: always
    ports:
      - "10301:30303"
      - "10301:30303/udp"
      - "10501:8545"
    command: /bitbon_node --datadir=~/.ethereum/bitbon init "/root/files/genesis.json"
    entrypoint: ["./entrypoint.sh"]
    volumes:
      - ./files/archive-nodes.json:/root/.ethereum/bitbon/geth/archive-nodes.json:rw
      - ./files/trusted-nodes.json:/root/.ethereum/bitbon/trusted-nodes.json:rw
      - ./files/static-nodes.json:/root/.ethereum/bitbon/static-nodes.json:rw
      - ./files/genesis.json:/root/files/genesis.json:ro
      - ./entrypoint_agent.sh:/entrypoint.sh
      - /etc/localtime:/etc/localtime:ro
    networks:
      nodes:
        ipv4_address: 172.30.238.113
    logging:
      driver: gelf
      options:
        gelf-address: "udp://192.168.253.21:11202"
        tag: "cpos-good-dev"
  archive:
    build: ../
    hostname: archive
    restart: always
    ports:
      - "10302:30303"
      - "10302:30303/udp"
      - "10502:8545"
    entrypoint: ["./entrypoint.sh"]
    volumes:
      - ./files/archive-nodes.json:/root/.ethereum/bitbon/geth/archive-nodes.json:rw
      - ./files/trusted-nodes.json:/root/.ethereum/bitbon/trusted-nodes.json:rw
      - ./files/static-nodes.json:/root/.ethereum/bitbon/static-nodes.json:rw
      - ./files/genesis.json:/root/files/genesis.json:ro
      - ./entrypoint_archive.sh:/entrypoint.sh
      - /etc/localtime:/etc/localtime:ro
    networks:
      nodes:
        ipv4_address: 172.30.238.114
    logging:
      driver: gelf
      options:
        gelf-address: "udp://192.168.253.21:11202"
        tag: "cpos-good-dev"
  miner_1:
    build: ../
    hostname: miner_1
    restart: always
    ports:
      - "10303:30303"
      - "10303:30303/udp"
      - "10503:8545"
    depends_on:
      - rabbitmq
    command: /bitbon_node --datadir=~/.ethereum/bitbon init "/root/files/genesis.json"
    entrypoint: ["./entrypoint.sh"]
    volumes:
      - ./files/archive-nodes.json:/root/.ethereum/bitbon/geth/archive-nodes.json:rw
      - ./files/trusted-nodes.json:/root/.ethereum/bitbon/trusted-nodes.json:rw
      - ./files/static-nodes.json:/root/.ethereum/bitbon/static-nodes.json:rw
      - ./files/genesis.json:/root/files/genesis.json:ro
      - ./entrypoint_miner_1.sh:/entrypoint.sh
      - /etc/localtime:/etc/localtime:ro
    networks:
      nodes:
        ipv4_address: 172.30.238.115
    logging:
      driver: gelf
      options:
        gelf-address: "udp://192.168.253.21:11202"
        tag: "cpos-good-dev"
  miner_2:
    build: ../
    hostname: miner_2
    restart: always
    ports:
      - "10304:30303"
      - "10304:30303/udp"
      - "10504:8545"
    depends_on:
      - rabbitmq
    command: /bitbon_node --datadir=~/.ethereum/bitbon init "/root/files/genesis.json"
    entrypoint: ["./entrypoint.sh"]
    volumes:
      - ./files/archive-nodes.json:/root/.ethereum/bitbon/geth/archive-nodes.json:rw
      - ./files/trusted-nodes.json:/root/.ethereum/bitbon/trusted-nodes.json:rw
      - ./files/static-nodes.json:/root/.ethereum/bitbon/static-nodes.json:rw
      - ./files/genesis.json:/root/files/genesis.json:ro
      - ./entrypoint_miner_2.sh:/entrypoint.sh
      - /etc/localtime:/etc/localtime:ro
    networks:
      nodes:
        ipv4_address: 172.30.238.116
    logging:
      driver: gelf
      options:
        gelf-address: "udp://192.168.253.21:11202"
        tag: "cpos-good-dev"
  netstats:
    image: kamael/eth-netstats
    restart: on-failure
    container_name: netstats
    environment:
      - HOST_IP=0.0.0.0
      - WS_SECRET=secret
    command: npm start
    volumes:
      - /etc/localtime:/etc/localtime:ro
    ports:
      - "3000:3000"
    networks:
      nodes:
        ipv4_address: 172.30.238.200
  eth-net-intelligence:
    image: registry.simcord.com/bitbon/bitbone-node/eth-net-intelligence-api:latest
    restart: on-failure
    container_name: eth-net-intelligence
    volumes:
      - ./files/app.json:/root/eth-net-intelligence-api/app.json:ro
    networks:
      nodes:
        ipv4_address: 172.30.238.201
networks:
  nodes:
    ipam:
      driver: default
      config:
        - subnet: 172.30.238.0/24
          gateway: 172.30.238.1
